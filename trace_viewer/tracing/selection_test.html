<!DOCTYPE html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/tracing/timeline_viewport.html">
<link rel="import" href="/tracing/test_utils.html">
<link rel="import" href="/tracing/trace_model.html">
<link rel="import" href="/tracing/selection.html">
<link rel="import" href="/tracing/tracks/slice_track.html">

<script>
'use strict';

tv.unittest.testSuite(function() {
  test('selectionObject', function() {
    var model = new tracing.TraceModel();
    var p1 = model.getOrCreateProcess(1);
    var t1 = p1.getOrCreateThread(1);
    t1.sliceGroup.pushSlice(
        new tracing.trace_model.ThreadSlice('', 'a', 0, 1, {}, 3));
    t1.sliceGroup.pushSlice(
        new tracing.trace_model.ThreadSlice('', 'a', 0, 5, {}, 1));

    var sel = new tracing.Selection();
    sel.push(t1.sliceGroup.slices[0]);

    assertEquals(1, sel.bounds.min);
    assertEquals(4, sel.bounds.max);
    assertEquals(t1.sliceGroup.slices[0], sel[0]);

    sel.push(t1.sliceGroup.slices[1]);
    assertEquals(1, sel.bounds.min);
    assertEquals(6, sel.bounds.max);
    assertEquals(t1.sliceGroup.slices[1], sel[1]);

    sel.clear();
    assertEquals(0, sel.length);
  });

  test('shiftedSelection', function() {
    var model = new tracing.TraceModel();
    var p1 = model.getOrCreateProcess(1);
    var t1 = p1.getOrCreateThread(1);
    t1.sliceGroup.pushSlice(
        new tracing.trace_model.ThreadSlice('', 'a', 0, 1, {}, 3));
    t1.sliceGroup.pushSlice(
        new tracing.trace_model.ThreadSlice('', 'a', 0, 5, {}, 1));

    var viewport = new tracing.TimelineViewport();
    var track = new tracing.tracks.SliceTrack(viewport);
    viewport.modelTrackContainer = track;
    track.slices = t1.sliceGroup.slices;

    viewport.rebuildEventToTrackMap();


    var sel = new tracing.Selection();
    sel.push(t1.sliceGroup.slices[0]);

    var shifted = sel.getShiftedSelection(track.viewport, 1);
    assertEquals(1, shifted.length);
    assertEquals(t1.sliceGroup.slices[1], shifted[0]);
  });

  test('uniqueContents', function() {
    var sample1 = {guid:1};
    var sample2 = {guid:2};

    var selection = new tracing.Selection();

    selection.push(sample1);
    selection.push(sample2);
    assertEquals(2, selection.length);

    selection.push(sample1);
    assertEquals(2, selection.length);
  });
});
</script>
